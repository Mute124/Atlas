<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Techstorm: Recommended usage patterns</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Techstorm-Logo-small.png"/></td>
  <td id="projectalign">
   <div id="projectname">Techstorm<span id="projectnumber">&#160;0.0.6</span>
   </div>
   <div id="projectbrief">The 5th iteration of the Techstorm game engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/dc0/usage_patterns.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Recommended usage patterns</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Vulkan gives great flexibility in memory allocation. This chapter shows the most common patterns.</p>
<p>See also slides from talk: <a href="https://www.gdcvault.com/play/1025458/Advanced-Graphics-Techniques-Tutorial-New">Sawicki, Adam. Advanced Graphics Techniques Tutorial: Memory management in Vulkan and DX12. Game Developers Conference, 2018</a></p>
<h1><a class="anchor" id="usage_patterns_gpu_only"></a>
GPU-only resource</h1>
<p><b>When:</b> Any resources that you frequently write and read on GPU, e.g. images used as color attachments (aka "render targets"), depth-stencil attachments, images/buffers used as storage image/buffer (aka "Unordered Access View (UAV)").</p>
<p><b>What to do:</b> Let the library select the optimal memory type, which will likely have <code>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT</code>.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="../../dc/d64/struct_vk_image_create_info.html">VkImageCreateInfo</a> imgCreateInfo = { <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a6c3f80c9a0267b7a8fa80ebd3344197c">VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO</a> };</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#aa595c6fabd7b5f39fec5765847bf8525">imageType</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#aa84985704e226942ee3d767563ed17b2a334b34484fb69a5e28522a5837233737">VK_IMAGE_TYPE_2D</a>;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#a8987da3bd3f1614dbb69a70fb3539299">extent</a>.<a class="code hl_variable" href="../../d1/da5/struct_vk_extent3_d.html#a5c0480aba24a58feed8834acdb442823">width</a> = 3840;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#a8987da3bd3f1614dbb69a70fb3539299">extent</a>.<a class="code hl_variable" href="../../d1/da5/struct_vk_extent3_d.html#a46a86cd9c09a22f5c35e0b70fc2808a0">height</a> = 2160;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#a8987da3bd3f1614dbb69a70fb3539299">extent</a>.<a class="code hl_variable" href="../../d1/da5/struct_vk_extent3_d.html#a03dd923b9778c6d1a3117fc22b47ac49">depth</a> = 1;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#a1ae4d9f8f412291dc7a124b715501d9b">mipLevels</a> = 1;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#a844cb4fcd6af3b0f1249342a1e603b2a">arrayLayers</a> = 1;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#a912f0e8e36d47c47e5651656a9b06013">format</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ad61b5b94a526d0f9ae0db97072cf6b3fa7a9d563b05a75170dd5a59d0bd123169">VK_FORMAT_R8G8B8A8_UNORM</a>;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#aa5f0d81d41a504e01c929179c568936b">tiling</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#a5456c8cb96f58d566fb71551a93fa8f4a19590de3e4e395ab085b010d99c526b2">VK_IMAGE_TILING_OPTIMAL</a>;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#a13d633f87608f9b3c4088a7af56d0670">initialLayout</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#a10d9a29817e871a926df1834c7ccd88ca8c82f4974a794a28089e82451bd98445">VK_IMAGE_LAYOUT_UNDEFINED</a>;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#ad5d6be080490a60ced3baaa4d4643dea">usage</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#a74802f743a6af41eb139fca85d5e7381a3a9d5e56e5250dbfae0d5e009d71786a">VK_IMAGE_USAGE_SAMPLED_BIT</a> | <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#a74802f743a6af41eb139fca85d5e7381a8fb6f8773b9f0ae2e313e19f6a2fbd52">VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT</a>;</div>
<div class="line">imgCreateInfo.<a class="code hl_variable" href="../../dc/d64/struct_vk_image_create_info.html#a8771ce56c0eca0bd7e82327e244da132">samples</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#a7972fb8a8ec7c225e60ca7c3de159706ae03a6b21b620e2c727076a3215b9f4fc">VK_SAMPLE_COUNT_1_BIT</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a> allocCreateInfo = {};</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910">usage</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a>;</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#add09658ac14fe290ace25470ddd6d41b">flags</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a3fc311d855c2ff53f1090ef5c722b38f">VMA_ALLOCATION_CREATE_DEDICATED_MEMORY_BIT</a>;</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#a983d39e1a2e63649d78a960aa2fdd0f7">priority</a> = 1.0f;</div>
<div class="line"> </div>
<div class="line">VkImage img;</div>
<div class="line"><a class="code hl_struct" href="../../d1/dc3/struct_vma_allocation.html">VmaAllocation</a> alloc;</div>
<div class="line"><a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#gaa76142ae43535c862ad9e194a6e38aaa">vmaCreateImage</a>(allocator, &amp;imgCreateInfo, &amp;allocCreateInfo, &amp;img, &amp;alloc, <span class="keyword">nullptr</span>);</div>
<div class="ttc" id="agroup__group__alloc_html_gaa76142ae43535c862ad9e194a6e38aaa"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#gaa76142ae43535c862ad9e194a6e38aaa">vmaCreateImage</a></div><div class="ttdeci">VMA_CALL_PRE VkResult VMA_CALL_POST vmaCreateImage(VmaAllocator VMA_NOT_NULL allocator, const VkImageCreateInfo *VMA_NOT_NULL pImageCreateInfo, const VmaAllocationCreateInfo *VMA_NOT_NULL pAllocationCreateInfo, VkImage VMA_NULLABLE_NON_DISPATCHABLE *VMA_NOT_NULL pImage, VmaAllocation VMA_NULLABLE *VMA_NOT_NULL pAllocation, VmaAllocationInfo *VMA_NULLABLE pAllocationInfo)</div><div class="ttdoc">Function similar to vmaCreateBuffer().</div></div>
<div class="ttc" id="agroup__group__alloc_html_ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a></div><div class="ttdeci">@ VMA_MEMORY_USAGE_AUTO</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l00492">vk_mem_alloc.h:492</a></div></div>
<div class="ttc" id="agroup__group__alloc_html_ggad9889c10c798b040d59c92f257cae597a3fc311d855c2ff53f1090ef5c722b38f"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a3fc311d855c2ff53f1090ef5c722b38f">VMA_ALLOCATION_CREATE_DEDICATED_MEMORY_BIT</a></div><div class="ttdeci">@ VMA_ALLOCATION_CREATE_DEDICATED_MEMORY_BIT</div><div class="ttdoc">Set this flag if the allocation should have its own memory block.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l00528">vk_mem_alloc.h:528</a></div></div>
<div class="ttc" id="astruct_vk_extent3_d_html_a03dd923b9778c6d1a3117fc22b47ac49"><div class="ttname"><a href="../../d1/da5/struct_vk_extent3_d.html#a03dd923b9778c6d1a3117fc22b47ac49">VkExtent3D::depth</a></div><div class="ttdeci">uint32_t depth</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01446">vulkan.h:1446</a></div></div>
<div class="ttc" id="astruct_vk_extent3_d_html_a46a86cd9c09a22f5c35e0b70fc2808a0"><div class="ttname"><a href="../../d1/da5/struct_vk_extent3_d.html#a46a86cd9c09a22f5c35e0b70fc2808a0">VkExtent3D::height</a></div><div class="ttdeci">uint32_t height</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01445">vulkan.h:1445</a></div></div>
<div class="ttc" id="astruct_vk_extent3_d_html_a5c0480aba24a58feed8834acdb442823"><div class="ttname"><a href="../../d1/da5/struct_vk_extent3_d.html#a5c0480aba24a58feed8834acdb442823">VkExtent3D::width</a></div><div class="ttdeci">uint32_t width</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01444">vulkan.h:1444</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html">VkImageCreateInfo</a></div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01981">vulkan.h:1981</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html_a13d633f87608f9b3c4088a7af56d0670"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html#a13d633f87608f9b3c4088a7af56d0670">VkImageCreateInfo::initialLayout</a></div><div class="ttdeci">VkImageLayout initialLayout</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01996">vulkan.h:1996</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html_a1ae4d9f8f412291dc7a124b715501d9b"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html#a1ae4d9f8f412291dc7a124b715501d9b">VkImageCreateInfo::mipLevels</a></div><div class="ttdeci">uint32_t mipLevels</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01988">vulkan.h:1988</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html_a844cb4fcd6af3b0f1249342a1e603b2a"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html#a844cb4fcd6af3b0f1249342a1e603b2a">VkImageCreateInfo::arrayLayers</a></div><div class="ttdeci">uint32_t arrayLayers</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01989">vulkan.h:1989</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html_a8771ce56c0eca0bd7e82327e244da132"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html#a8771ce56c0eca0bd7e82327e244da132">VkImageCreateInfo::samples</a></div><div class="ttdeci">VkSampleCountFlagBits samples</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01990">vulkan.h:1990</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html_a8987da3bd3f1614dbb69a70fb3539299"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html#a8987da3bd3f1614dbb69a70fb3539299">VkImageCreateInfo::extent</a></div><div class="ttdeci">VkExtent3D extent</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01987">vulkan.h:1987</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html_a912f0e8e36d47c47e5651656a9b06013"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html#a912f0e8e36d47c47e5651656a9b06013">VkImageCreateInfo::format</a></div><div class="ttdeci">VkFormat format</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01986">vulkan.h:1986</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html_aa595c6fabd7b5f39fec5765847bf8525"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html#aa595c6fabd7b5f39fec5765847bf8525">VkImageCreateInfo::imageType</a></div><div class="ttdeci">VkImageType imageType</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01985">vulkan.h:1985</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html_aa5f0d81d41a504e01c929179c568936b"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html#aa5f0d81d41a504e01c929179c568936b">VkImageCreateInfo::tiling</a></div><div class="ttdeci">VkImageTiling tiling</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01991">vulkan.h:1991</a></div></div>
<div class="ttc" id="astruct_vk_image_create_info_html_ad5d6be080490a60ced3baaa4d4643dea"><div class="ttname"><a href="../../dc/d64/struct_vk_image_create_info.html#ad5d6be080490a60ced3baaa4d4643dea">VkImageCreateInfo::usage</a></div><div class="ttdeci">VkImageUsageFlags usage</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01992">vulkan.h:1992</a></div></div>
<div class="ttc" id="astruct_vma_allocation_create_info_html"><div class="ttname"><a href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a></div><div class="ttdoc">Parameters of new VmaAllocation.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01221">vk_mem_alloc.h:1222</a></div></div>
<div class="ttc" id="astruct_vma_allocation_create_info_html_a983d39e1a2e63649d78a960aa2fdd0f7"><div class="ttname"><a href="../../da/d54/struct_vma_allocation_create_info.html#a983d39e1a2e63649d78a960aa2fdd0f7">VmaAllocationCreateInfo::priority</a></div><div class="ttdeci">float priority</div><div class="ttdoc">A floating-point value between 0 and 1, indicating the priority of the allocation relative to other m...</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01268">vk_mem_alloc.h:1268</a></div></div>
<div class="ttc" id="astruct_vma_allocation_create_info_html_accb8b06b1f677d858cb9af20705fa910"><div class="ttname"><a href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910">VmaAllocationCreateInfo::usage</a></div><div class="ttdeci">VmaMemoryUsage usage</div><div class="ttdoc">Intended usage of memory.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01230">vk_mem_alloc.h:1230</a></div></div>
<div class="ttc" id="astruct_vma_allocation_create_info_html_add09658ac14fe290ace25470ddd6d41b"><div class="ttname"><a href="../../da/d54/struct_vma_allocation_create_info.html#add09658ac14fe290ace25470ddd6d41b">VmaAllocationCreateInfo::flags</a></div><div class="ttdeci">VmaAllocationCreateFlags flags</div><div class="ttdoc">Use VmaAllocationCreateFlagBits enum.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01224">vk_mem_alloc.h:1224</a></div></div>
<div class="ttc" id="astruct_vma_allocation_html"><div class="ttname"><a href="../../d1/dc3/struct_vma_allocation.html">VmaAllocation</a></div><div class="ttdoc">Represents single memory allocation.</div></div>
<div class="ttc" id="avulkan_8h_html_a10d9a29817e871a926df1834c7ccd88ca8c82f4974a794a28089e82451bd98445"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#a10d9a29817e871a926df1834c7ccd88ca8c82f4974a794a28089e82451bd98445">VK_IMAGE_LAYOUT_UNDEFINED</a></div><div class="ttdeci">@ VK_IMAGE_LAYOUT_UNDEFINED</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00813">vulkan.h:813</a></div></div>
<div class="ttc" id="avulkan_8h_html_a5456c8cb96f58d566fb71551a93fa8f4a19590de3e4e395ab085b010d99c526b2"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#a5456c8cb96f58d566fb71551a93fa8f4a19590de3e4e395ab085b010d99c526b2">VK_IMAGE_TILING_OPTIMAL</a></div><div class="ttdeci">@ VK_IMAGE_TILING_OPTIMAL</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00826">vulkan.h:826</a></div></div>
<div class="ttc" id="avulkan_8h_html_a74802f743a6af41eb139fca85d5e7381a3a9d5e56e5250dbfae0d5e009d71786a"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#a74802f743a6af41eb139fca85d5e7381a3a9d5e56e5250dbfae0d5e009d71786a">VK_IMAGE_USAGE_SAMPLED_BIT</a></div><div class="ttdeci">@ VK_IMAGE_USAGE_SAMPLED_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00839">vulkan.h:839</a></div></div>
<div class="ttc" id="avulkan_8h_html_a74802f743a6af41eb139fca85d5e7381a8fb6f8773b9f0ae2e313e19f6a2fbd52"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#a74802f743a6af41eb139fca85d5e7381a8fb6f8773b9f0ae2e313e19f6a2fbd52">VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT</a></div><div class="ttdeci">@ VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00841">vulkan.h:841</a></div></div>
<div class="ttc" id="avulkan_8h_html_a7972fb8a8ec7c225e60ca7c3de159706ae03a6b21b620e2c727076a3215b9f4fc"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#a7972fb8a8ec7c225e60ca7c3de159706ae03a6b21b620e2c727076a3215b9f4fc">VK_SAMPLE_COUNT_1_BIT</a></div><div class="ttdeci">@ VK_SAMPLE_COUNT_1_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01207">vulkan.h:1207</a></div></div>
<div class="ttc" id="avulkan_8h_html_aa84985704e226942ee3d767563ed17b2a334b34484fb69a5e28522a5837233737"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#aa84985704e226942ee3d767563ed17b2a334b34484fb69a5e28522a5837233737">VK_IMAGE_TYPE_2D</a></div><div class="ttdeci">@ VK_IMAGE_TYPE_2D</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00832">vulkan.h:832</a></div></div>
<div class="ttc" id="avulkan_8h_html_ad61b5b94a526d0f9ae0db97072cf6b3fa7a9d563b05a75170dd5a59d0bd123169"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#ad61b5b94a526d0f9ae0db97072cf6b3fa7a9d563b05a75170dd5a59d0bd123169">VK_FORMAT_R8G8B8A8_UNORM</a></div><div class="ttdeci">@ VK_FORMAT_R8G8B8A8_UNORM</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00626">vulkan.h:626</a></div></div>
<div class="ttc" id="avulkan_8h_html_aff9f2b99398eb80a2b5a146bc5534ce8a6c3f80c9a0267b7a8fa80ebd3344197c"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a6c3f80c9a0267b7a8fa80ebd3344197c">VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO</a></div><div class="ttdeci">@ VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01069">vulkan.h:1069</a></div></div>
</div><!-- fragment --><p><b>Also consider:</b> Consider creating them as dedicated allocations using <a class="el" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a3fc311d855c2ff53f1090ef5c722b38f" title="Set this flag if the allocation should have its own memory block.">VMA_ALLOCATION_CREATE_DEDICATED_MEMORY_BIT</a>, especially if they are large or if you plan to destroy and recreate them with different sizes e.g. when display resolution changes. Prefer to create such resources first and all other GPU resources (like textures and vertex buffers) later. When VK_EXT_memory_priority extension is enabled, it is also worth setting high priority to such allocation to decrease chances to be evicted to system memory by the operating system.</p>
<h1><a class="anchor" id="usage_patterns_staging_copy_upload"></a>
Staging copy for upload</h1>
<p><b>When:</b> A "staging" buffer than you want to map and fill from CPU code, then use as a source od transfer to some GPU resource.</p>
<p><b>What to do:</b> Use flag <a class="el" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a9be224df3bfc1cfa06203aed689a30c5">VMA_ALLOCATION_CREATE_HOST_ACCESS_SEQUENTIAL_WRITE_BIT</a>. Let the library select the optimal memory type, which will always have <code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code>.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a> bufCreateInfo = { <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</a> };</div>
<div class="line">bufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#a230f56cdd2cce941ed343cec0756e59f">size</a> = 65536;</div>
<div class="line">bufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">usage</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a99f8f265d9d6dccbaa85d63807471909">VK_BUFFER_USAGE_TRANSFER_SRC_BIT</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a> allocCreateInfo = {};</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910">usage</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a>;</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#add09658ac14fe290ace25470ddd6d41b">flags</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a9be224df3bfc1cfa06203aed689a30c5">VMA_ALLOCATION_CREATE_HOST_ACCESS_SEQUENTIAL_WRITE_BIT</a> |</div>
<div class="line">    <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a11da372cc3a82931c5e5d6146cd9dd1f">VMA_ALLOCATION_CREATE_MAPPED_BIT</a>;</div>
<div class="line"> </div>
<div class="line">VkBuffer buf;</div>
<div class="line"><a class="code hl_struct" href="../../d1/dc3/struct_vma_allocation.html">VmaAllocation</a> alloc;</div>
<div class="line"><a class="code hl_struct" href="../../d4/d25/struct_vma_allocation_info.html">VmaAllocationInfo</a> allocInfo;</div>
<div class="line"><a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#gae9773fe0ef8582e23136d2d83c336ab9">vmaCreateBuffer</a>(allocator, &amp;bufCreateInfo, &amp;allocCreateInfo, &amp;buf, &amp;alloc, &amp;allocInfo);</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">memcpy(allocInfo.<a class="code hl_variable" href="../../d4/d25/struct_vma_allocation_info.html#a17a39eb34201a610347acb91b38eca79">pMappedData</a>, myData, myDataSize);</div>
<div class="ttc" id="agroup__group__alloc_html_gae9773fe0ef8582e23136d2d83c336ab9"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#gae9773fe0ef8582e23136d2d83c336ab9">vmaCreateBuffer</a></div><div class="ttdeci">VMA_CALL_PRE VkResult VMA_CALL_POST vmaCreateBuffer(VmaAllocator VMA_NOT_NULL allocator, const VkBufferCreateInfo *VMA_NOT_NULL pBufferCreateInfo, const VmaAllocationCreateInfo *VMA_NOT_NULL pAllocationCreateInfo, VkBuffer VMA_NULLABLE_NON_DISPATCHABLE *VMA_NOT_NULL pBuffer, VmaAllocation VMA_NULLABLE *VMA_NOT_NULL pAllocation, VmaAllocationInfo *VMA_NULLABLE pAllocationInfo)</div><div class="ttdoc">Creates a new VkBuffer, allocates and binds memory for it.</div></div>
<div class="ttc" id="agroup__group__alloc_html_ggad9889c10c798b040d59c92f257cae597a11da372cc3a82931c5e5d6146cd9dd1f"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a11da372cc3a82931c5e5d6146cd9dd1f">VMA_ALLOCATION_CREATE_MAPPED_BIT</a></div><div class="ttdeci">@ VMA_ALLOCATION_CREATE_MAPPED_BIT</div><div class="ttdoc">Set this flag to use a memory that will be persistently mapped and retrieve pointer to it.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l00549">vk_mem_alloc.h:549</a></div></div>
<div class="ttc" id="agroup__group__alloc_html_ggad9889c10c798b040d59c92f257cae597a9be224df3bfc1cfa06203aed689a30c5"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a9be224df3bfc1cfa06203aed689a30c5">VMA_ALLOCATION_CREATE_HOST_ACCESS_SEQUENTIAL_WRITE_BIT</a></div><div class="ttdeci">@ VMA_ALLOCATION_CREATE_HOST_ACCESS_SEQUENTIAL_WRITE_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l00598">vk_mem_alloc.h:598</a></div></div>
<div class="ttc" id="astruct_vk_buffer_create_info_html"><div class="ttname"><a href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a></div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01907">vulkan.h:1907</a></div></div>
<div class="ttc" id="astruct_vk_buffer_create_info_html_a230f56cdd2cce941ed343cec0756e59f"><div class="ttname"><a href="../../d8/d77/struct_vk_buffer_create_info.html#a230f56cdd2cce941ed343cec0756e59f">VkBufferCreateInfo::size</a></div><div class="ttdeci">VkDeviceSize size</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01911">vulkan.h:1911</a></div></div>
<div class="ttc" id="astruct_vk_buffer_create_info_html_af0a7239bbc17deb173bff21fee13876c"><div class="ttname"><a href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">VkBufferCreateInfo::usage</a></div><div class="ttdeci">VkBufferUsageFlags usage</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01912">vulkan.h:1912</a></div></div>
<div class="ttc" id="astruct_vma_allocation_info_html"><div class="ttname"><a href="../../d4/d25/struct_vma_allocation_info.html">VmaAllocationInfo</a></div><div class="ttdoc">Parameters of VmaAllocation objects, that can be retrieved using function vmaGetAllocationInfo().</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01336">vk_mem_alloc.h:1337</a></div></div>
<div class="ttc" id="astruct_vma_allocation_info_html_a17a39eb34201a610347acb91b38eca79"><div class="ttname"><a href="../../d4/d25/struct_vma_allocation_info.html#a17a39eb34201a610347acb91b38eca79">VmaAllocationInfo::pMappedData</a></div><div class="ttdeci">void *VMA_NULLABLE pMappedData</div><div class="ttdoc">Pointer to the beginning of this allocation as mapped data.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01379">vk_mem_alloc.h:1379</a></div></div>
<div class="ttc" id="avulkan_8h_html_ab2928667b5068a6978859a143e5fc6b6a99f8f265d9d6dccbaa85d63807471909"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a99f8f265d9d6dccbaa85d63807471909">VK_BUFFER_USAGE_TRANSFER_SRC_BIT</a></div><div class="ttdeci">@ VK_BUFFER_USAGE_TRANSFER_SRC_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00482">vulkan.h:482</a></div></div>
<div class="ttc" id="avulkan_8h_html_aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</a></div><div class="ttdeci">@ VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01067">vulkan.h:1067</a></div></div>
</div><!-- fragment --><p><b>Also consider:</b> You can map the allocation using <a class="el" href="../../d2/d8a/group__group__alloc.html#ga13b93ec0ed38ad7232300cb94931c8d2" title="Maps memory represented by given allocation and returns pointer to it.">vmaMapMemory()</a> or you can create it as persistenly mapped using <a class="el" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a11da372cc3a82931c5e5d6146cd9dd1f" title="Set this flag to use a memory that will be persistently mapped and retrieve pointer to it.">VMA_ALLOCATION_CREATE_MAPPED_BIT</a>, as in the example above.</p>
<h1><a class="anchor" id="usage_patterns_readback"></a>
Readback</h1>
<p><b>When:</b> Buffers for data written by or transferred from the GPU that you want to read back on the CPU, e.g. results of some computations.</p>
<p><b>What to do:</b> Use flag <a class="el" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597add61238d98e20917b9a06c617763f492">VMA_ALLOCATION_CREATE_HOST_ACCESS_RANDOM_BIT</a>. Let the library select the optimal memory type, which will always have <code>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</code> and <code>VK_MEMORY_PROPERTY_HOST_CACHED_BIT</code>.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a> bufCreateInfo = { <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</a> };</div>
<div class="line">bufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#a230f56cdd2cce941ed343cec0756e59f">size</a> = 65536;</div>
<div class="line">bufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">usage</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a2671050fa41ffb988c79ac40e67fa25d">VK_BUFFER_USAGE_TRANSFER_DST_BIT</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a> allocCreateInfo = {};</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910">usage</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a>;</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#add09658ac14fe290ace25470ddd6d41b">flags</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597add61238d98e20917b9a06c617763f492">VMA_ALLOCATION_CREATE_HOST_ACCESS_RANDOM_BIT</a> |</div>
<div class="line">    <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a11da372cc3a82931c5e5d6146cd9dd1f">VMA_ALLOCATION_CREATE_MAPPED_BIT</a>;</div>
<div class="line"> </div>
<div class="line">VkBuffer buf;</div>
<div class="line"><a class="code hl_struct" href="../../d1/dc3/struct_vma_allocation.html">VmaAllocation</a> alloc;</div>
<div class="line"><a class="code hl_struct" href="../../d4/d25/struct_vma_allocation_info.html">VmaAllocationInfo</a> allocInfo;</div>
<div class="line"><a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#gae9773fe0ef8582e23136d2d83c336ab9">vmaCreateBuffer</a>(allocator, &amp;bufCreateInfo, &amp;allocCreateInfo, &amp;buf, &amp;alloc, &amp;allocInfo);</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">const <span class="keywordtype">float</span>* downloadedData = (<span class="keyword">const</span> <span class="keywordtype">float</span>*)allocInfo.<a class="code hl_variable" href="../../d4/d25/struct_vma_allocation_info.html#a17a39eb34201a610347acb91b38eca79">pMappedData</a>;</div>
<div class="ttc" id="agroup__group__alloc_html_ggad9889c10c798b040d59c92f257cae597add61238d98e20917b9a06c617763f492"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597add61238d98e20917b9a06c617763f492">VMA_ALLOCATION_CREATE_HOST_ACCESS_RANDOM_BIT</a></div><div class="ttdeci">@ VMA_ALLOCATION_CREATE_HOST_ACCESS_RANDOM_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l00610">vk_mem_alloc.h:610</a></div></div>
<div class="ttc" id="avulkan_8h_html_ab2928667b5068a6978859a143e5fc6b6a2671050fa41ffb988c79ac40e67fa25d"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a2671050fa41ffb988c79ac40e67fa25d">VK_BUFFER_USAGE_TRANSFER_DST_BIT</a></div><div class="ttdeci">@ VK_BUFFER_USAGE_TRANSFER_DST_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00483">vulkan.h:483</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="usage_patterns_advanced_data_uploading"></a>
Advanced data uploading</h1>
<p>For resources that you frequently write on CPU via mapped pointer and freqnently read on GPU e.g. as a uniform buffer (also called "dynamic"), multiple options are possible:</p>
<ol type="1">
<li>Easiest solution is to have one copy of the resource in <code>HOST_VISIBLE</code> memory, even if it means system RAM (not <code>DEVICE_LOCAL</code>) on systems with a discrete graphics card, and make the device reach out to that resource directly.<ul>
<li>Reads performed by the device will then go through PCI Express bus. The performace of this access may be limited, but it may be fine depending on the size of this resource (whether it is small enough to quickly end up in GPU cache) and the sparsity of access.</li>
</ul>
</li>
<li>On systems with unified memory (e.g. AMD APU or Intel integrated graphics, mobile chips), a memory type may be available that is both <code>HOST_VISIBLE</code> (available for mapping) and <code>DEVICE_LOCAL</code> (fast to access from the GPU). Then, it is likely the best choice for such type of resource.</li>
<li>Systems with a discrete graphics card and separate video memory may or may not expose a memory type that is both <code>HOST_VISIBLE</code> and <code>DEVICE_LOCAL</code>, also known as Base Address Register (BAR). If they do, it represents a piece of VRAM (or entire VRAM, if ReBAR is enabled in the motherboard BIOS) that is available to CPU for mapping.<ul>
<li>Writes performed by the host to that memory go through PCI Express bus. The performance of these writes may be limited, but it may be fine, especially on PCIe 4.0, as long as rules of using uncached and write-combined memory are followed - only sequential writes and no reads.</li>
</ul>
</li>
<li>Finally, you may need or prefer to create a separate copy of the resource in <code>DEVICE_LOCAL</code> memory, a separate "staging" copy in <code>HOST_VISIBLE</code> memory and perform an explicit transfer command between them.</li>
</ol>
<p>Thankfully, VMA offers an aid to create and use such resources in the the way optimal for the current Vulkan device. To help the library make the best choice, use flag <a class="el" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a9be224df3bfc1cfa06203aed689a30c5">VMA_ALLOCATION_CREATE_HOST_ACCESS_SEQUENTIAL_WRITE_BIT</a> together with <a class="el" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a11337f96eacf34c1016c339eac165cad">VMA_ALLOCATION_CREATE_HOST_ACCESS_ALLOW_TRANSFER_INSTEAD_BIT</a>. It will then prefer a memory type that is both <code>DEVICE_LOCAL</code> and <code>HOST_VISIBLE</code> (integrated memory or BAR), but if no such memory type is available or allocation from it fails (PC graphics cards have only 256 MB of BAR by default, unless ReBAR is supported and enabled in BIOS), it will fall back to <code>DEVICE_LOCAL</code> memory for fast GPU access. It is then up to you to detect that the allocation ended up in a memory type that is not <code>HOST_VISIBLE</code>, so you need to create another "staging" allocation and perform explicit transfers.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a> bufCreateInfo = { <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</a> };</div>
<div class="line">bufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#a230f56cdd2cce941ed343cec0756e59f">size</a> = 65536;</div>
<div class="line">bufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">usage</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a6d37618aae152245b1ee0ef58e71d6f2">VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT</a> | <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a2671050fa41ffb988c79ac40e67fa25d">VK_BUFFER_USAGE_TRANSFER_DST_BIT</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a> allocCreateInfo = {};</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910">usage</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a>;</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#add09658ac14fe290ace25470ddd6d41b">flags</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a9be224df3bfc1cfa06203aed689a30c5">VMA_ALLOCATION_CREATE_HOST_ACCESS_SEQUENTIAL_WRITE_BIT</a> |</div>
<div class="line">    <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a11337f96eacf34c1016c339eac165cad">VMA_ALLOCATION_CREATE_HOST_ACCESS_ALLOW_TRANSFER_INSTEAD_BIT</a> |</div>
<div class="line">    <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a11da372cc3a82931c5e5d6146cd9dd1f">VMA_ALLOCATION_CREATE_MAPPED_BIT</a>;</div>
<div class="line"> </div>
<div class="line">VkBuffer buf;</div>
<div class="line"><a class="code hl_struct" href="../../d1/dc3/struct_vma_allocation.html">VmaAllocation</a> alloc;</div>
<div class="line"><a class="code hl_struct" href="../../d4/d25/struct_vma_allocation_info.html">VmaAllocationInfo</a> allocInfo;</div>
<div class="line"><a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#gae9773fe0ef8582e23136d2d83c336ab9">vmaCreateBuffer</a>(allocator, &amp;bufCreateInfo, &amp;allocCreateInfo, &amp;buf, &amp;alloc, &amp;allocInfo);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="../../d8/d55/vulkan_8h.html#a06f71178c68bf5712dbec35d6f124122">VkMemoryPropertyFlags</a> memPropFlags;</div>
<div class="line"><a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#gaf6785483eda8b53561437e05e2177d7b">vmaGetAllocationMemoryProperties</a>(allocator, alloc, &amp;memPropFlags);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(memPropFlags &amp; <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#a1afa959bb41f921269625a6372267856ae23c8f86393a2ec9210f7677a41118bf">VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Allocation ended up in a mappable memory and is already mapped - write to it directly.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// [Executed in runtime]:</span></div>
<div class="line">    memcpy(allocInfo.<a class="code hl_variable" href="../../d4/d25/struct_vma_allocation_info.html#a17a39eb34201a610347acb91b38eca79">pMappedData</a>, myData, myDataSize);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Allocation ended up in a non-mappable memory - need to transfer.</span></div>
<div class="line">    <a class="code hl_struct" href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a> stagingBufCreateInfo = { <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</a> };</div>
<div class="line">    stagingBufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#a230f56cdd2cce941ed343cec0756e59f">size</a> = 65536;</div>
<div class="line">    stagingBufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">usage</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a99f8f265d9d6dccbaa85d63807471909">VK_BUFFER_USAGE_TRANSFER_SRC_BIT</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a> stagingAllocCreateInfo = {};</div>
<div class="line">    stagingAllocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910">usage</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a>;</div>
<div class="line">    stagingAllocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#add09658ac14fe290ace25470ddd6d41b">flags</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a9be224df3bfc1cfa06203aed689a30c5">VMA_ALLOCATION_CREATE_HOST_ACCESS_SEQUENTIAL_WRITE_BIT</a> |</div>
<div class="line">        <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a11da372cc3a82931c5e5d6146cd9dd1f">VMA_ALLOCATION_CREATE_MAPPED_BIT</a>;</div>
<div class="line"> </div>
<div class="line">    VkBuffer stagingBuf;</div>
<div class="line">    <a class="code hl_struct" href="../../d1/dc3/struct_vma_allocation.html">VmaAllocation</a> stagingAlloc;</div>
<div class="line">    <a class="code hl_struct" href="../../d4/d25/struct_vma_allocation_info.html">VmaAllocationInfo</a> stagingAllocInfo;</div>
<div class="line">    <a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#gae9773fe0ef8582e23136d2d83c336ab9">vmaCreateBuffer</a>(allocator, &amp;stagingBufCreateInfo, &amp;stagingAllocCreateInfo,</div>
<div class="line">        &amp;stagingBuf, &amp;stagingAlloc, stagingAllocInfo);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// [Executed in runtime]:</span></div>
<div class="line">    memcpy(stagingAllocInfo.<a class="code hl_variable" href="../../d4/d25/struct_vma_allocation_info.html#a17a39eb34201a610347acb91b38eca79">pMappedData</a>, myData, myDataSize);</div>
<div class="line">    <span class="comment">//vkCmdPipelineBarrier: VK_ACCESS_HOST_WRITE_BIT --&gt; VK_ACCESS_TRANSFER_READ_BIT</span></div>
<div class="line">    <a class="code hl_struct" href="../../dd/d13/struct_vk_buffer_copy.html">VkBufferCopy</a> bufCopy = {</div>
<div class="line">        0, <span class="comment">// srcOffset</span></div>
<div class="line">        0, <span class="comment">// dstOffset,</span></div>
<div class="line">        myDataSize); <span class="comment">// size</span></div>
<div class="line">    <a class="code hl_define" href="../../d8/d55/vulkan_8h.html#ad587652cb54eb8b4db78c5944a9ac6b6">vkCmdCopyBuffer</a>(cmdBuf, stagingBuf, buf, 1, &amp;bufCopy);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__group__alloc_html_gaf6785483eda8b53561437e05e2177d7b"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#gaf6785483eda8b53561437e05e2177d7b">vmaGetAllocationMemoryProperties</a></div><div class="ttdeci">VMA_CALL_PRE void VMA_CALL_POST vmaGetAllocationMemoryProperties(VmaAllocator VMA_NOT_NULL allocator, VmaAllocation VMA_NOT_NULL allocation, VkMemoryPropertyFlags *VMA_NOT_NULL pFlags)</div><div class="ttdoc">Given an allocation, returns Property Flags of its memory type.</div></div>
<div class="ttc" id="agroup__group__alloc_html_ggad9889c10c798b040d59c92f257cae597a11337f96eacf34c1016c339eac165cad"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a11337f96eacf34c1016c339eac165cad">VMA_ALLOCATION_CREATE_HOST_ACCESS_ALLOW_TRANSFER_INSTEAD_BIT</a></div><div class="ttdeci">@ VMA_ALLOCATION_CREATE_HOST_ACCESS_ALLOW_TRANSFER_INSTEAD_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l00622">vk_mem_alloc.h:622</a></div></div>
<div class="ttc" id="astruct_vk_buffer_copy_html"><div class="ttname"><a href="../../dd/d13/struct_vk_buffer_copy.html">VkBufferCopy</a></div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l02018">vulkan.h:2018</a></div></div>
<div class="ttc" id="avulkan_8h_html_a06f71178c68bf5712dbec35d6f124122"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#a06f71178c68bf5712dbec35d6f124122">VkMemoryPropertyFlags</a></div><div class="ttdeci">VkFlags VkMemoryPropertyFlags</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01740">vulkan.h:1740</a></div></div>
<div class="ttc" id="avulkan_8h_html_a1afa959bb41f921269625a6372267856ae23c8f86393a2ec9210f7677a41118bf"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#a1afa959bb41f921269625a6372267856ae23c8f86393a2ec9210f7677a41118bf">VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</a></div><div class="ttdeci">@ VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00912">vulkan.h:912</a></div></div>
<div class="ttc" id="avulkan_8h_html_ab2928667b5068a6978859a143e5fc6b6a6d37618aae152245b1ee0ef58e71d6f2"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a6d37618aae152245b1ee0ef58e71d6f2">VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT</a></div><div class="ttdeci">@ VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00486">vulkan.h:486</a></div></div>
<div class="ttc" id="avulkan_8h_html_ad587652cb54eb8b4db78c5944a9ac6b6"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#ad587652cb54eb8b4db78c5944a9ac6b6">vkCmdCopyBuffer</a></div><div class="ttdeci">#define vkCmdCopyBuffer</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l03145">vulkan.h:3145</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="usage_patterns_other_use_cases"></a>
Other use cases</h1>
<p>Here are some other, less obvious use cases and their recommended settings:</p>
<ul>
<li>An image that is used only as transfer source and destination, but it should stay on the device, as it is used to temporarily store a copy of some texture, e.g. from the current to the next frame, for temporal antialiasing or other temporal effects.<ul>
<li>Use <code><a class="el" href="../../dc/d64/struct_vk_image_create_info.html#ad5d6be080490a60ced3baaa4d4643dea">VkImageCreateInfo::usage</a> = VK_IMAGE_USAGE_TRANSFER_SRC_BIT | VK_IMAGE_USAGE_TRANSFER_DST_BIT</code></li>
<li>Use <a class="el" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910" title="Intended usage of memory.">VmaAllocationCreateInfo::usage</a> = <a class="el" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a></li>
</ul>
</li>
<li>An image that is used only as transfer source and destination, but it should be placed in the system RAM despite it doesn't need to be mapped, because it serves as a "swap" copy to evict least recently used textures from VRAM.<ul>
<li>Use <code><a class="el" href="../../dc/d64/struct_vk_image_create_info.html#ad5d6be080490a60ced3baaa4d4643dea">VkImageCreateInfo::usage</a> = VK_IMAGE_USAGE_TRANSFER_SRC_BIT | VK_IMAGE_USAGE_TRANSFER_DST_BIT</code></li>
<li>Use <a class="el" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910" title="Intended usage of memory.">VmaAllocationCreateInfo::usage</a> = <a class="el" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca9b422585242160b8ed3418310ee6664d">VMA_MEMORY_USAGE_AUTO_PREFER_HOST</a>, as VMA needs a hint here to differentiate from the previous case.</li>
</ul>
</li>
<li>A buffer that you want to map and write from the CPU, directly read from the GPU (e.g. as a uniform or vertex buffer), but you have a clear preference to place it in device or host memory due to its large size.<ul>
<li>Use <code><a class="el" href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">VkBufferCreateInfo::usage</a> = VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT</code></li>
<li>Use <a class="el" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910" title="Intended usage of memory.">VmaAllocationCreateInfo::usage</a> = <a class="el" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305ccae2adb696d6a73c18bb20c23666661327">VMA_MEMORY_USAGE_AUTO_PREFER_DEVICE</a> or <a class="el" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca9b422585242160b8ed3418310ee6664d">VMA_MEMORY_USAGE_AUTO_PREFER_HOST</a></li>
<li>Use <a class="el" href="../../da/d54/struct_vma_allocation_create_info.html#add09658ac14fe290ace25470ddd6d41b" title="Use VmaAllocationCreateFlagBits enum.">VmaAllocationCreateInfo::flags</a> = <a class="el" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a9be224df3bfc1cfa06203aed689a30c5">VMA_ALLOCATION_CREATE_HOST_ACCESS_SEQUENTIAL_WRITE_BIT</a> </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Vulkan Memory Allocator</a></li>
    <li class="footer">Generated on Sun Dec 1 2024 for Techstorm by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
