<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Techstorm: Custom memory pools</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../Techstorm-Logo-small.png"/></td>
  <td id="projectalign">
   <div id="projectname">Techstorm<span id="projectnumber">&#160;0.0.6</span>
   </div>
   <div id="projectbrief">The 5th iteration of the Techstorm game engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d6/d89/custom_memory_pools.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Custom memory pools</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A memory pool contains a number of <code>VkDeviceMemory</code> blocks. The library automatically creates and manages default pool for each memory type available on the device. Default memory pool automatically grows in size. Size of allocated blocks is also variable and managed automatically.</p>
<p>You can create custom pool and allocate memory out of it. It can be useful if you want to:</p>
<ul>
<li>Keep certain kind of allocations separate from others.</li>
<li>Enforce particular, fixed size of Vulkan memory blocks.</li>
<li>Limit maximum amount of Vulkan memory allocated for that pool.</li>
<li>Reserve minimum or fixed amount of Vulkan memory always preallocated for that pool.</li>
<li>Use extra parameters for a set of your allocations that are available in <a class="el" href="../../d9/dc9/struct_vma_pool_create_info.html" title="Describes parameter of created VmaPool.">VmaPoolCreateInfo</a> but not in <a class="el" href="../../da/d54/struct_vma_allocation_create_info.html" title="Parameters of new VmaAllocation.">VmaAllocationCreateInfo</a> - e.g., custom minimum alignment, custom <code>pNext</code> chain.</li>
<li>Perform defragmentation on a specific subset of your allocations.</li>
</ul>
<p>To use custom memory pools:</p>
<ol type="1">
<li>Fill <a class="el" href="../../d9/dc9/struct_vma_pool_create_info.html" title="Describes parameter of created VmaPool.">VmaPoolCreateInfo</a> structure.</li>
<li>Call <a class="el" href="../../d2/d8a/group__group__alloc.html#ga250d4f6f4c09a6a03b82323f999c9c4e" title="Allocates Vulkan device memory and creates VmaPool object.">vmaCreatePool()</a> to obtain <a class="el" href="../../d1/d67/struct_vma_pool.html" title="Represents custom memory pool.">VmaPool</a> handle.</li>
<li>When making an allocation, set <a class="el" href="../../da/d54/struct_vma_allocation_create_info.html#ad5aa903b9be1fa934abf2dd6c650fca6" title="Pool that this allocation should be created in.">VmaAllocationCreateInfo::pool</a> to this handle. You don't need to specify any other parameters of this structure, like <code>usage</code>.</li>
</ol>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="comment">// Find memoryTypeIndex for the pool.</span></div>
<div class="line"><a class="code hl_struct" href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a> sampleBufCreateInfo = { <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</a> };</div>
<div class="line">sampleBufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#a230f56cdd2cce941ed343cec0756e59f">size</a> = 0x10000; <span class="comment">// Doesn&#39;t matter.</span></div>
<div class="line">sampleBufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">usage</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a6d37618aae152245b1ee0ef58e71d6f2">VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT</a> | <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a2671050fa41ffb988c79ac40e67fa25d">VK_BUFFER_USAGE_TRANSFER_DST_BIT</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a> sampleAllocCreateInfo = {};</div>
<div class="line">sampleAllocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910">usage</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a>;</div>
<div class="line"> </div>
<div class="line">uint32_t memTypeIndex;</div>
<div class="line"><a class="code hl_enumeration" href="../../d8/d55/vulkan_8h.html#abe3614d1bd40772bc2398a4a86ea4a45">VkResult</a> res = <a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#ga723f5683b363c306bf860dab1861f299">vmaFindMemoryTypeIndexForBufferInfo</a>(allocator,</div>
<div class="line">    &amp;sampleBufCreateInfo, &amp;sampleAllocCreateInfo, &amp;memTypeIndex);</div>
<div class="line"><span class="comment">// Check res...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a pool that can have at most 2 blocks, 128 MiB each.</span></div>
<div class="line"><a class="code hl_struct" href="../../d9/dc9/struct_vma_pool_create_info.html">VmaPoolCreateInfo</a> poolCreateInfo = {};</div>
<div class="line">poolCreateInfo.<a class="code hl_variable" href="../../d9/dc9/struct_vma_pool_create_info.html#a596fa76b685d3f1f688f84a709a5b319">memoryTypeIndex</a> = memTypeIndex;</div>
<div class="line">poolCreateInfo.<a class="code hl_variable" href="../../d9/dc9/struct_vma_pool_create_info.html#aa4265160536cdb9be821b7686c16c676">blockSize</a> = 128ull * 1024 * 1024;</div>
<div class="line">poolCreateInfo.<a class="code hl_variable" href="../../d9/dc9/struct_vma_pool_create_info.html#ae41142f2834fcdc82baa4883c187b75c">maxBlockCount</a> = 2;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../d1/d67/struct_vma_pool.html">VmaPool</a> pool;</div>
<div class="line">res = <a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#ga250d4f6f4c09a6a03b82323f999c9c4e">vmaCreatePool</a>(allocator, &amp;poolCreateInfo, &amp;pool);</div>
<div class="line"><span class="comment">// Check res...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Allocate a buffer out of it.</span></div>
<div class="line"><a class="code hl_struct" href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a> bufCreateInfo = { <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</a> };</div>
<div class="line">bufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#a230f56cdd2cce941ed343cec0756e59f">size</a> = 1024;</div>
<div class="line">bufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">usage</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a6d37618aae152245b1ee0ef58e71d6f2">VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT</a> | <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a2671050fa41ffb988c79ac40e67fa25d">VK_BUFFER_USAGE_TRANSFER_DST_BIT</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a> allocCreateInfo = {};</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#ad5aa903b9be1fa934abf2dd6c650fca6">pool</a> = pool;</div>
<div class="line"> </div>
<div class="line">VkBuffer buf;</div>
<div class="line"><a class="code hl_struct" href="../../d1/dc3/struct_vma_allocation.html">VmaAllocation</a> alloc;</div>
<div class="line">res = <a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#gae9773fe0ef8582e23136d2d83c336ab9">vmaCreateBuffer</a>(allocator, &amp;bufCreateInfo, &amp;allocCreateInfo, &amp;buf, &amp;alloc, <span class="keyword">nullptr</span>);</div>
<div class="line"><span class="comment">// Check res...</span></div>
<div class="ttc" id="agroup__group__alloc_html_ga250d4f6f4c09a6a03b82323f999c9c4e"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#ga250d4f6f4c09a6a03b82323f999c9c4e">vmaCreatePool</a></div><div class="ttdeci">VMA_CALL_PRE VkResult VMA_CALL_POST vmaCreatePool(VmaAllocator VMA_NOT_NULL allocator, const VmaPoolCreateInfo *VMA_NOT_NULL pCreateInfo, VmaPool VMA_NULLABLE *VMA_NOT_NULL pPool)</div><div class="ttdoc">Allocates Vulkan device memory and creates VmaPool object.</div></div>
<div class="ttc" id="agroup__group__alloc_html_ga723f5683b363c306bf860dab1861f299"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#ga723f5683b363c306bf860dab1861f299">vmaFindMemoryTypeIndexForBufferInfo</a></div><div class="ttdeci">VMA_CALL_PRE VkResult VMA_CALL_POST vmaFindMemoryTypeIndexForBufferInfo(VmaAllocator VMA_NOT_NULL allocator, const VkBufferCreateInfo *VMA_NOT_NULL pBufferCreateInfo, const VmaAllocationCreateInfo *VMA_NOT_NULL pAllocationCreateInfo, uint32_t *VMA_NOT_NULL pMemoryTypeIndex)</div><div class="ttdoc">Helps to find memoryTypeIndex, given VkBufferCreateInfo and VmaAllocationCreateInfo.</div></div>
<div class="ttc" id="agroup__group__alloc_html_gae9773fe0ef8582e23136d2d83c336ab9"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#gae9773fe0ef8582e23136d2d83c336ab9">vmaCreateBuffer</a></div><div class="ttdeci">VMA_CALL_PRE VkResult VMA_CALL_POST vmaCreateBuffer(VmaAllocator VMA_NOT_NULL allocator, const VkBufferCreateInfo *VMA_NOT_NULL pBufferCreateInfo, const VmaAllocationCreateInfo *VMA_NOT_NULL pAllocationCreateInfo, VkBuffer VMA_NULLABLE_NON_DISPATCHABLE *VMA_NOT_NULL pBuffer, VmaAllocation VMA_NULLABLE *VMA_NOT_NULL pAllocation, VmaAllocationInfo *VMA_NULLABLE pAllocationInfo)</div><div class="ttdoc">Creates a new VkBuffer, allocates and binds memory for it.</div></div>
<div class="ttc" id="agroup__group__alloc_html_ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a></div><div class="ttdeci">@ VMA_MEMORY_USAGE_AUTO</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l00492">vk_mem_alloc.h:492</a></div></div>
<div class="ttc" id="astruct_vk_buffer_create_info_html"><div class="ttname"><a href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a></div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01907">vulkan.h:1907</a></div></div>
<div class="ttc" id="astruct_vk_buffer_create_info_html_a230f56cdd2cce941ed343cec0756e59f"><div class="ttname"><a href="../../d8/d77/struct_vk_buffer_create_info.html#a230f56cdd2cce941ed343cec0756e59f">VkBufferCreateInfo::size</a></div><div class="ttdeci">VkDeviceSize size</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01911">vulkan.h:1911</a></div></div>
<div class="ttc" id="astruct_vk_buffer_create_info_html_af0a7239bbc17deb173bff21fee13876c"><div class="ttname"><a href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">VkBufferCreateInfo::usage</a></div><div class="ttdeci">VkBufferUsageFlags usage</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01912">vulkan.h:1912</a></div></div>
<div class="ttc" id="astruct_vma_allocation_create_info_html"><div class="ttname"><a href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a></div><div class="ttdoc">Parameters of new VmaAllocation.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01221">vk_mem_alloc.h:1222</a></div></div>
<div class="ttc" id="astruct_vma_allocation_create_info_html_accb8b06b1f677d858cb9af20705fa910"><div class="ttname"><a href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910">VmaAllocationCreateInfo::usage</a></div><div class="ttdeci">VmaMemoryUsage usage</div><div class="ttdoc">Intended usage of memory.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01230">vk_mem_alloc.h:1230</a></div></div>
<div class="ttc" id="astruct_vma_allocation_create_info_html_ad5aa903b9be1fa934abf2dd6c650fca6"><div class="ttname"><a href="../../da/d54/struct_vma_allocation_create_info.html#ad5aa903b9be1fa934abf2dd6c650fca6">VmaAllocationCreateInfo::pool</a></div><div class="ttdeci">VmaPool VMA_NULLABLE pool</div><div class="ttdoc">Pool that this allocation should be created in.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01254">vk_mem_alloc.h:1254</a></div></div>
<div class="ttc" id="astruct_vma_allocation_html"><div class="ttname"><a href="../../d1/dc3/struct_vma_allocation.html">VmaAllocation</a></div><div class="ttdoc">Represents single memory allocation.</div></div>
<div class="ttc" id="astruct_vma_pool_create_info_html"><div class="ttname"><a href="../../d9/dc9/struct_vma_pool_create_info.html">VmaPoolCreateInfo</a></div><div class="ttdoc">Describes parameter of created VmaPool.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01272">vk_mem_alloc.h:1273</a></div></div>
<div class="ttc" id="astruct_vma_pool_create_info_html_a596fa76b685d3f1f688f84a709a5b319"><div class="ttname"><a href="../../d9/dc9/struct_vma_pool_create_info.html#a596fa76b685d3f1f688f84a709a5b319">VmaPoolCreateInfo::memoryTypeIndex</a></div><div class="ttdeci">uint32_t memoryTypeIndex</div><div class="ttdoc">Vulkan memory type index to allocate this pool from.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01276">vk_mem_alloc.h:1276</a></div></div>
<div class="ttc" id="astruct_vma_pool_create_info_html_aa4265160536cdb9be821b7686c16c676"><div class="ttname"><a href="../../d9/dc9/struct_vma_pool_create_info.html#aa4265160536cdb9be821b7686c16c676">VmaPoolCreateInfo::blockSize</a></div><div class="ttdeci">VkDeviceSize blockSize</div><div class="ttdoc">Size of a single VkDeviceMemory block to be allocated as part of this pool, in bytes....</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01289">vk_mem_alloc.h:1289</a></div></div>
<div class="ttc" id="astruct_vma_pool_create_info_html_ae41142f2834fcdc82baa4883c187b75c"><div class="ttname"><a href="../../d9/dc9/struct_vma_pool_create_info.html#ae41142f2834fcdc82baa4883c187b75c">VmaPoolCreateInfo::maxBlockCount</a></div><div class="ttdeci">size_t maxBlockCount</div><div class="ttdoc">Maximum number of blocks that can be allocated in this pool. Optional.</div><div class="ttdef"><b>Definition</b> <a href="../../df/d75/vk__mem__alloc_8h_source.html#l01302">vk_mem_alloc.h:1302</a></div></div>
<div class="ttc" id="astruct_vma_pool_html"><div class="ttname"><a href="../../d1/d67/struct_vma_pool.html">VmaPool</a></div><div class="ttdoc">Represents custom memory pool.</div></div>
<div class="ttc" id="avulkan_8h_html_ab2928667b5068a6978859a143e5fc6b6a2671050fa41ffb988c79ac40e67fa25d"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a2671050fa41ffb988c79ac40e67fa25d">VK_BUFFER_USAGE_TRANSFER_DST_BIT</a></div><div class="ttdeci">@ VK_BUFFER_USAGE_TRANSFER_DST_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00483">vulkan.h:483</a></div></div>
<div class="ttc" id="avulkan_8h_html_ab2928667b5068a6978859a143e5fc6b6a6d37618aae152245b1ee0ef58e71d6f2"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a6d37618aae152245b1ee0ef58e71d6f2">VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT</a></div><div class="ttdeci">@ VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00486">vulkan.h:486</a></div></div>
<div class="ttc" id="avulkan_8h_html_abe3614d1bd40772bc2398a4a86ea4a45"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#abe3614d1bd40772bc2398a4a86ea4a45">VkResult</a></div><div class="ttdeci">VkResult</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l00994">vulkan.h:994</a></div></div>
<div class="ttc" id="avulkan_8h_html_aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a"><div class="ttname"><a href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</a></div><div class="ttdeci">@ VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</div><div class="ttdef"><b>Definition</b> <a href="../../d8/d55/vulkan_8h_source.html#l01067">vulkan.h:1067</a></div></div>
</div><!-- fragment --><p>You have to free all allocations made from this pool before destroying it.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#gafcc45e5a6388ab35daa9a46688baee20">vmaDestroyBuffer</a>(allocator, buf, alloc);</div>
<div class="line"><a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#gad03da7fd4d8b772bc2a299bc34850d98">vmaDestroyPool</a>(allocator, pool);</div>
<div class="ttc" id="agroup__group__alloc_html_gad03da7fd4d8b772bc2a299bc34850d98"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#gad03da7fd4d8b772bc2a299bc34850d98">vmaDestroyPool</a></div><div class="ttdeci">VMA_CALL_PRE void VMA_CALL_POST vmaDestroyPool(VmaAllocator VMA_NOT_NULL allocator, VmaPool VMA_NULLABLE pool)</div><div class="ttdoc">Destroys VmaPool object and frees Vulkan device memory.</div></div>
<div class="ttc" id="agroup__group__alloc_html_gafcc45e5a6388ab35daa9a46688baee20"><div class="ttname"><a href="../../d2/d8a/group__group__alloc.html#gafcc45e5a6388ab35daa9a46688baee20">vmaDestroyBuffer</a></div><div class="ttdeci">VMA_CALL_PRE void VMA_CALL_POST vmaDestroyBuffer(VmaAllocator VMA_NOT_NULL allocator, VkBuffer VMA_NULLABLE_NON_DISPATCHABLE buffer, VmaAllocation VMA_NULLABLE allocation)</div><div class="ttdoc">Destroys Vulkan buffer and frees allocated memory.</div></div>
</div><!-- fragment --><p>New versions of this library support creating dedicated allocations in custom pools. It is supported only when <a class="el" href="../../d9/dc9/struct_vma_pool_create_info.html#aa4265160536cdb9be821b7686c16c676" title="Size of a single VkDeviceMemory block to be allocated as part of this pool, in bytes....">VmaPoolCreateInfo::blockSize</a> = 0. To use this feature, set <a class="el" href="../../da/d54/struct_vma_allocation_create_info.html#ad5aa903b9be1fa934abf2dd6c650fca6" title="Pool that this allocation should be created in.">VmaAllocationCreateInfo::pool</a> to the pointer to your custom pool and <a class="el" href="../../da/d54/struct_vma_allocation_create_info.html#add09658ac14fe290ace25470ddd6d41b" title="Use VmaAllocationCreateFlagBits enum.">VmaAllocationCreateInfo::flags</a> to <a class="el" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a3fc311d855c2ff53f1090ef5c722b38f" title="Set this flag if the allocation should have its own memory block.">VMA_ALLOCATION_CREATE_DEDICATED_MEMORY_BIT</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Excessive use of custom pools is a common mistake when using this library. Custom pools may be useful for special purposes - when you want to keep certain type of resources separate e.g. to reserve minimum amount of memory for them or limit maximum amount of memory they can occupy. For most resources this is not needed and so it is not recommended to create <a class="el" href="../../d1/d67/struct_vma_pool.html" title="Represents custom memory pool.">VmaPool</a> objects and allocations out of them. Allocating from the default pool is sufficient.</dd></dl>
<h1><a class="anchor" id="custom_memory_pools_MemTypeIndex"></a>
Choosing memory type index</h1>
<p>When creating a pool, you must explicitly specify memory type index. To find the one suitable for your buffers or images, you can use helper functions <a class="el" href="../../d2/d8a/group__group__alloc.html#ga723f5683b363c306bf860dab1861f299" title="Helps to find memoryTypeIndex, given VkBufferCreateInfo and VmaAllocationCreateInfo.">vmaFindMemoryTypeIndexForBufferInfo()</a>, <a class="el" href="../../d2/d8a/group__group__alloc.html#gaaf05345771a087328949b485ff2da4db" title="Helps to find memoryTypeIndex, given VkImageCreateInfo and VmaAllocationCreateInfo.">vmaFindMemoryTypeIndexForImageInfo()</a>. You need to provide structures with example parameters of buffers or images that you are going to create in that pool.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a> exampleBufCreateInfo = { <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#aff9f2b99398eb80a2b5a146bc5534ce8a5a546cbe030772b33c39ab807a8fb59a">VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</a> };</div>
<div class="line">exampleBufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#a230f56cdd2cce941ed343cec0756e59f">size</a> = 1024; <span class="comment">// Doesn&#39;t matter</span></div>
<div class="line">exampleBufCreateInfo.<a class="code hl_variable" href="../../d8/d77/struct_vk_buffer_create_info.html#af0a7239bbc17deb173bff21fee13876c">usage</a> = <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a6d37618aae152245b1ee0ef58e71d6f2">VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT</a> | <a class="code hl_enumvalue" href="../../d8/d55/vulkan_8h.html#ab2928667b5068a6978859a143e5fc6b6a2671050fa41ffb988c79ac40e67fa25d">VK_BUFFER_USAGE_TRANSFER_DST_BIT</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../da/d54/struct_vma_allocation_create_info.html">VmaAllocationCreateInfo</a> allocCreateInfo = {};</div>
<div class="line">allocCreateInfo.<a class="code hl_variable" href="../../da/d54/struct_vma_allocation_create_info.html#accb8b06b1f677d858cb9af20705fa910">usage</a> = <a class="code hl_enumvalue" href="../../d2/d8a/group__group__alloc.html#ggaa5846affa1e9da3800e3e78fae2305cca27cde9026a84d34d525777baa41fce6e">VMA_MEMORY_USAGE_AUTO</a>;</div>
<div class="line"> </div>
<div class="line">uint32_t memTypeIndex;</div>
<div class="line"><a class="code hl_function" href="../../d2/d8a/group__group__alloc.html#ga723f5683b363c306bf860dab1861f299">vmaFindMemoryTypeIndexForBufferInfo</a>(allocator, &amp;exampleBufCreateInfo, &amp;allocCreateInfo, &amp;memTypeIndex);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../d9/dc9/struct_vma_pool_create_info.html">VmaPoolCreateInfo</a> poolCreateInfo = {};</div>
<div class="line">poolCreateInfo.<a class="code hl_variable" href="../../d9/dc9/struct_vma_pool_create_info.html#a596fa76b685d3f1f688f84a709a5b319">memoryTypeIndex</a> = memTypeIndex;</div>
<div class="line"><span class="comment">// ...</span></div>
</div><!-- fragment --><p>When creating buffers/images allocated in that pool, provide following parameters:</p>
<ul>
<li><code><a class="el" href="../../d8/d77/struct_vk_buffer_create_info.html">VkBufferCreateInfo</a></code>: Prefer to pass same parameters as above. Otherwise you risk creating resources in a memory type that is not suitable for them, which may result in undefined behavior. Using different <code>VK_BUFFER_USAGE_</code> flags may work, but you shouldn't create images in a pool intended for buffers or the other way around.</li>
<li><a class="el" href="../../da/d54/struct_vma_allocation_create_info.html" title="Parameters of new VmaAllocation.">VmaAllocationCreateInfo</a>: You don't need to pass same parameters. Fill only <code>pool</code> member. Other members are ignored anyway.</li>
</ul>
<h1><a class="anchor" id="linear_algorithm"></a>
Linear allocation algorithm</h1>
<p>Each Vulkan memory block managed by this library has accompanying metadata that keeps track of used and unused regions. By default, the metadata structure and algorithm tries to find best place for new allocations among free regions to optimize memory usage. This way you can allocate and free objects in any order.</p>
<p><img src="../../../gfx/Linear_allocator_1_algo_default.png" alt="Default allocation algorithm" class="inline"/></p>
<p>Sometimes there is a need to use simpler, linear allocation algorithm. You can create custom pool that uses such algorithm by adding flag <a class="el" href="../../d2/d8a/group__group__alloc.html#gga9a7c45f9c863695d98c83fa5ac940fe7a13c8a444197c67866be9cb05599fc726" title="Enables alternative, linear allocation algorithm in this pool.">VMA_POOL_CREATE_LINEAR_ALGORITHM_BIT</a> to <a class="el" href="../../d9/dc9/struct_vma_pool_create_info.html#a8405139f63d078340ae74513a59f5446" title="Use combination of VmaPoolCreateFlagBits.">VmaPoolCreateInfo::flags</a> while creating <a class="el" href="../../d1/d67/struct_vma_pool.html" title="Represents custom memory pool.">VmaPool</a> object. Then an alternative metadata management is used. It always creates new allocations after last one and doesn't reuse free regions after allocations freed in the middle. It results in better allocation performance and less memory consumed by metadata.</p>
<p><img src="../../../gfx/Linear_allocator_2_algo_linear.png" alt="Linear allocation algorithm" class="inline"/></p>
<p>With this one flag, you can create a custom pool that can be used in many ways: free-at-once, stack, double stack, and ring buffer. See below for details. You don't need to specify explicitly which of these options you are going to use - it is detected automatically.</p>
<h2><a class="anchor" id="linear_algorithm_free_at_once"></a>
Free-at-once</h2>
<p>In a pool that uses linear algorithm, you still need to free all the allocations individually, e.g. by using <a class="el" href="../../d2/d8a/group__group__alloc.html#ga5c9baca5124d440046bbe508f61d2839" title="Frees memory previously allocated using vmaAllocateMemory(), vmaAllocateMemoryForBuffer(),...">vmaFreeMemory()</a> or <a class="el" href="../../d2/d8a/group__group__alloc.html#gafcc45e5a6388ab35daa9a46688baee20" title="Destroys Vulkan buffer and frees allocated memory.">vmaDestroyBuffer()</a>. You can free them in any order. New allocations are always made after last one - free space in the middle is not reused. However, when you release all the allocation and the pool becomes empty, allocation starts from the beginning again. This way you can use linear algorithm to speed up creation of allocations that you are going to release all at once.</p>
<p><img src="../../../gfx/Linear_allocator_3_free_at_once.png" alt="Free-at-once" class="inline"/></p>
<p>This mode is also available for pools created with <a class="el" href="../../d9/dc9/struct_vma_pool_create_info.html#ae41142f2834fcdc82baa4883c187b75c" title="Maximum number of blocks that can be allocated in this pool. Optional.">VmaPoolCreateInfo::maxBlockCount</a> value that allows multiple memory blocks.</p>
<h2><a class="anchor" id="linear_algorithm_stack"></a>
Stack</h2>
<p>When you free an allocation that was created last, its space can be reused. Thanks to this, if you always release allocations in the order opposite to their creation (LIFO - Last In First Out), you can achieve behavior of a stack.</p>
<p><img src="../../../gfx/Linear_allocator_4_stack.png" alt="Stack" class="inline"/></p>
<p>This mode is also available for pools created with <a class="el" href="../../d9/dc9/struct_vma_pool_create_info.html#ae41142f2834fcdc82baa4883c187b75c" title="Maximum number of blocks that can be allocated in this pool. Optional.">VmaPoolCreateInfo::maxBlockCount</a> value that allows multiple memory blocks.</p>
<h2><a class="anchor" id="linear_algorithm_double_stack"></a>
Double stack</h2>
<p>The space reserved by a custom pool with linear algorithm may be used by two stacks:</p>
<ul>
<li>First, default one, growing up from offset 0.</li>
<li>Second, "upper" one, growing down from the end towards lower offsets.</li>
</ul>
<p>To make allocation from the upper stack, add flag <a class="el" href="../../d2/d8a/group__group__alloc.html#ggad9889c10c798b040d59c92f257cae597a42ba3a2d2c7117953210b7c3ef8da0df">VMA_ALLOCATION_CREATE_UPPER_ADDRESS_BIT</a> to <a class="el" href="../../da/d54/struct_vma_allocation_create_info.html#add09658ac14fe290ace25470ddd6d41b" title="Use VmaAllocationCreateFlagBits enum.">VmaAllocationCreateInfo::flags</a>.</p>
<p><img src="../../../gfx/Linear_allocator_7_double_stack.png" alt="Double stack" class="inline"/></p>
<p>Double stack is available only in pools with one memory block - <a class="el" href="../../d9/dc9/struct_vma_pool_create_info.html#ae41142f2834fcdc82baa4883c187b75c" title="Maximum number of blocks that can be allocated in this pool. Optional.">VmaPoolCreateInfo::maxBlockCount</a> must be 1. Otherwise behavior is undefined.</p>
<p>When the two stacks' ends meet so there is not enough space between them for a new allocation, such allocation fails with usual <code>VK_ERROR_OUT_OF_DEVICE_MEMORY</code> error.</p>
<h2><a class="anchor" id="linear_algorithm_ring_buffer"></a>
Ring buffer</h2>
<p>When you free some allocations from the beginning and there is not enough free space for a new one at the end of a pool, allocator's "cursor" wraps around to the beginning and starts allocation there. Thanks to this, if you always release allocations in the same order as you created them (FIFO - First In First Out), you can achieve behavior of a ring buffer / queue.</p>
<p><img src="../../../gfx/Linear_allocator_5_ring_buffer.png" alt="Ring buffer" class="inline"/></p>
<p>Ring buffer is available only in pools with one memory block - <a class="el" href="../../d9/dc9/struct_vma_pool_create_info.html#ae41142f2834fcdc82baa4883c187b75c" title="Maximum number of blocks that can be allocated in this pool. Optional.">VmaPoolCreateInfo::maxBlockCount</a> must be 1. Otherwise behavior is undefined.</p>
<dl class="section note"><dt>Note</dt><dd><a class="el" href="../../dd/d7d/defragmentation.html">Defragmentation</a> is not supported in custom pools created with <a class="el" href="../../d2/d8a/group__group__alloc.html#gga9a7c45f9c863695d98c83fa5ac940fe7a13c8a444197c67866be9cb05599fc726" title="Enables alternative, linear allocation algorithm in this pool.">VMA_POOL_CREATE_LINEAR_ALGORITHM_BIT</a>. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Vulkan Memory Allocator</a></li>
    <li class="footer">Generated on Sun Dec 1 2024 for Techstorm by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
